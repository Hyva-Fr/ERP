<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Ip;

class IpSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     * @throws \JsonException
     * @throws \Exception
     */
    public function run()
    {
        $data = json_decode('[{"date":"2022-04-17 09:24:38","ip":"40.74.76.54"},{"date":"2022-04-17 09:24:38","ip":"40.122.156.26"},{"date":"2022-04-17 09:24:38","ip":"87.249.133.69"},{"date":"2022-04-17 09:24:38","ip":"216.24.178.85"},{"date":"2022-04-17 09:24:38","ip":"95.181.237.36"},{"date":"2022-04-17 09:24:35","ip":"45.150.226.51"},{"date":"2022-04-17 07:15:07","ip":"85.208.98.228"},{"date":"2022-04-17 04:05:05","ip":"185.7.145.47"},{"date":"2022-04-17 04:05:05","ip":"103.147.185.28"},{"date":"2022-04-17 04:02:49","ip":"5.189.165.142"},{"date":"2022-04-17 02:11:56","ip":"35.169.224.116"},{"date":"2022-04-16 09:04:47","ip":"192.36.53.165"},{"date":"2022-04-16 02:47:21","ip":"173.252.127.15"},{"date":"2022-04-16 02:47:19","ip":"66.220.149.6"},{"date":"2022-04-16 02:45:48","ip":"31.13.115.23"},{"date":"2022-04-16 02:45:48","ip":"31.13.115.1"},{"date":"2022-04-16 02:45:48","ip":"31.13.115.5"},{"date":"2022-04-16 02:43:19","ip":"66.220.149.23"},{"date":"2022-04-15 11:38:18","ip":"107.23.202.176"},{"date":"2022-04-15 06:10:24","ip":"205.237.95.240"},{"date":"2022-04-14 16:29:01","ip":"89.64.88.223"},{"date":"2022-04-14 09:25:22","ip":"40.115.203.119"},{"date":"2022-04-14 04:16:35","ip":"66.220.149.7"},{"date":"2022-04-14 04:16:05","ip":"66.220.149.17"},{"date":"2022-04-14 04:15:58","ip":"66.220.149.119"},{"date":"2022-04-14 04:04:33","ip":"84.38.135.138"},{"date":"2022-04-13 12:05:32","ip":"185.249.12.153"},{"date":"2022-04-13 11:36:27","ip":"2.44.167.59"},{"date":"2022-04-13 10:16:49","ip":"68.183.135.246"},{"date":"2022-04-13 06:28:40","ip":"31.13.115.9"}]', true, 512, JSON_THROW_ON_ERROR);
        foreach ($data as $row) {
            $attempts = random_int(1, 5);
            $is_ban = ($attempts === 5) ? 1 : 0;
            Ip::create([
                'address' => $row['ip'],
                'attempts' => $attempts,
                'data' => json_encode(\Location::get($row['ip']), JSON_THROW_ON_ERROR),
                'is_ban' => $is_ban,
                'created_at' => $row['date'],
                'updated_at' => ($attempts === 1) ? null : $row['date']
            ]);
        }
    }
}
